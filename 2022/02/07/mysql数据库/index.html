<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="chaoqiang.qiu">
    
    <title>
        
            mysql数据库 |
        
        进击的阿强
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"chaoqiang6.github.io","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                进击的阿强
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">mysql数据库</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">chaoqiang.qiu</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-02-07 22:02:03</span>
        <span class="mobile">2022-02-07 22:02</span>
    </span>
    
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>事务</p>
<blockquote><p>A <strong>database transaction</strong> symbolizes a unit of work performed within a <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Database_management_system">database management system<i class="fas fa-external-link-alt"></i></a> (or similar system) against a <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Database">database<i class="fas fa-external-link-alt"></i></a>, and treated in a coherent and reliable way independent of other transactions. A transaction generally represents any change in a database. Transactions in a database environment have two main purposes:</p>
<p>数据库事务象征着在一个数据库管理系统(或类似系统)中执行的工作单元，并以一种连贯可靠的，独立于其他事务去执行。一个事务通常表示在数据库中的任何修改。数据库环境中的事务有两大目的</p>
<ol>
<li><p>To provide reliable units of work that allow correct recovery from failures and keep a database consistent even in cases of system failure, when execution prematurely and unexpectedly stops (completely or partially) and many operations upon a database remain uncompleted, with unclear status.</p>
<p>提供可靠的单元工作(失败可回滚，系统崩了能持久保存数据并保持数据库一致性)</p>
</li>
<li><p>To provide isolation between programs accessing a database concurrently. If this isolation is not provided, the programs’ outcomes are possibly erroneous.</p>
<p>程序并发访问数据库时提供隔离机制</p>
</li>
</ol>
<p>In a database management system, a transaction is a single unit of logic or work, sometimes made up of multiple operations. Any logical calculation done in a consistent mode in a database is known as a transaction. One example is a transfer from one bank account to another: the complete transaction requires subtracting the amount to be transferred from one account and adding that same amount to the other.</p>
<p>A database transaction, by definition, must be <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Atomicity_(database_systems)">atomic<i class="fas fa-external-link-alt"></i></a> (it must either be complete in its entirety or have no effect whatsoever), <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Consistency_(database_systems)">consistent<i class="fas fa-external-link-alt"></i></a> (it must conform to existing constraints in the database), <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Isolation_(database_systems)">isolated<i class="fas fa-external-link-alt"></i></a> (it must not affect other transactions) and <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Durability_(database_systems)">durable<i class="fas fa-external-link-alt"></i></a> (it must get written to persistent storage).[<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Database_transaction#cite_note-1">1]<i class="fas fa-external-link-alt"></i></a> Database practitioners often refer to these properties of database transactions using the acronym <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/ACID">ACID<i class="fas fa-external-link-alt"></i></a>.</p>
<footer><strong>WikiPedia</strong><cite><a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Database_transaction)">database transaction<i class="fas fa-external-link-alt"></i></a></cite></footer></blockquote>







<p>事务四大特性</p>
<ul>
<li>原子性Atomicity<ul>
<li>要么不成功，要么全部成功</li>
</ul>
</li>
<li>一致性Consistency</li>
</ul>
<blockquote><p><strong>Consistency (or Correctness)</strong> in <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Database_systems">database systems<i class="fas fa-external-link-alt"></i></a> refers to the requirement that <font color="red"> any given <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Database_transaction">database transaction<i class="fas fa-external-link-alt"></i></a> must change affected data only in allowed ways. </font>Any data written to the database must be valid according to all defined rules, including <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Integrity_constraints">constraints<i class="fas fa-external-link-alt"></i></a>, <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cascading_rollback">cascades<i class="fas fa-external-link-alt"></i></a>, <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Database_trigger">triggers<i class="fas fa-external-link-alt"></i></a>, and any combination thereof. This does not guarantee correctness of the transaction in all ways the application programmer might have wanted (that is the responsibility of application-level code) but merely that any programming errors cannot result in the violation of any defined database constraints</p>
<p>数据库系统中的<strong>一致性</strong>（或正确性）是指任何给定的数据库事务必须仅以允许的方式更改受影响的数据的要求。写入数据库的任何数据都必须根据所有定义的规则有效，包括约束、级联、触发器及其任何组合。这并不能保证应用程序程序员可能想要的所有事务的正确性（这是应用程序级代码的责任），而只是任何编程错误都不会导致违反任何定义的数据库约束</p>
<p>大概意思是对事务操作必须按照预先定义好的规则去修改数据，网上都用转账来举例子，但是假设程序员写了bug，A向B转账1000，A-1000，B+800，程序执行完成后也遵循了一致性原则，因为你的逻辑就是那样规定的</p>
<footer><strong>WikiPedia</strong><cite><a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Consistency_(database_systems)">Consistency (database systems)<i class="fas fa-external-link-alt"></i></a></cite></footer></blockquote>

<ul>
<li>事务发生前的状态和发生后的状态守恒(也可以想象能量守恒)<ul>
<li>比如银行转账</li>
<li>小偷偷钱</li>
<li>将可乐从罐子里导入瓶子里</li>
</ul>
</li>
<li>隔离性Isolation<ul>
<li>一个事务的执行不被另一个事务的执行干扰。</li>
</ul>
</li>
<li>持久性Durability<ul>
<li>指一个事务一旦提交，它对数据库中数据的改变是永久性的。</li>
</ul>
</li>
</ul>
<p>如何实现一致性呢?可以认为只要实现了原子性，就实现了一致性</p>
<h2 id="Mysql数据类型"><a href="#Mysql数据类型" class="headerlink" title="Mysql数据类型"></a>Mysql数据类型</h2><p><img src="/2022/02/07/mysql%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220211211812448.png" alt="image-20220211211812448"></p>
<p><img src="/2022/02/07/mysql%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220211211853307.png" alt="image-20220211211853307"></p>
<p><img src="/2022/02/07/mysql%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220211214148748.png" alt="image-20220211214148748"></p>
<p><img src="/2022/02/07/mysql%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220211214555630.png" alt="image-20220211214555630"></p>
<h2 id="Sql语句"><a href="#Sql语句" class="headerlink" title="Sql语句"></a>Sql语句</h2><table>
<thead>
<tr>
<th>分类</th>
<th>全称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>[DDL](# DDL)</td>
<td>Data Defination Language</td>
<td>数据定义语言，用于定义数据库对象(数据库，表，字段)</td>
</tr>
<tr>
<td>[DML](# DML)</td>
<td>Data Manipulation Language</td>
<td>数据操作语言，用来对数据库表中的数据进行增删改</td>
</tr>
<tr>
<td>[DQL](# DQL)</td>
<td>Data Query Language</td>
<td>数据查询语言，用来查询数据库中表的记录</td>
</tr>
<tr>
<td>[DCL](# DCL)</td>
<td>Data Control Language</td>
<td>数据控制语言，用来创建数据库用户，控制数据库的访问权限</td>
</tr>
</tbody></table>
<h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><p>Data Defination Language</p>
<h4 id="数据库操作-查询所有数据库"><a href="#数据库操作-查询所有数据库" class="headerlink" title="数据库操作-查询所有数据库"></a>数据库操作-查询所有数据库</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure>

<h4 id="数据库操作-查看当前数据库"><a href="#数据库操作-查看当前数据库" class="headerlink" title="数据库操作-查看当前数据库"></a>数据库操作-查看当前数据库</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> database();</span><br></pre></td></tr></table></figure>

<h4 id="数据库操作-创建"><a href="#数据库操作-创建" class="headerlink" title="数据库操作-创建"></a>数据库操作-创建</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 数据库名 [<span class="keyword">DEFAULT</span> CHARSET 字符集] [<span class="keyword">COLLATE</span> 排序规则];</span><br></pre></td></tr></table></figure>

<h4 id="数据库操作-删除"><a href="#数据库操作-删除" class="headerlink" title="数据库操作-删除"></a>数据库操作-删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database [if <span class="keyword">exists</span>] 数据库名</span><br></pre></td></tr></table></figure>

<h4 id="数据库操作-使用"><a href="#数据库操作-使用" class="headerlink" title="数据库操作-使用"></a>数据库操作-使用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE 数据库名</span><br></pre></td></tr></table></figure>

<h4 id="表操作-查询当前数据库所有表"><a href="#表操作-查询当前数据库所有表" class="headerlink" title="表操作-查询当前数据库所有表"></a>表操作-查询当前数据库所有表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>

<h4 id="表操作-查询表结构"><a href="#表操作-查询表结构" class="headerlink" title="表操作-查询表结构"></a>表操作-查询表结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> tb_name</span><br></pre></td></tr></table></figure>

<h4 id="表操作-查询指定表的建表语句"><a href="#表操作-查询指定表的建表语句" class="headerlink" title="表操作-查询指定表的建表语句"></a>表操作-查询指定表的建表语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> tb_name;</span><br></pre></td></tr></table></figure>



<h4 id="表操作-创建"><a href="#表操作-创建" class="headerlink" title="表操作-创建"></a>表操作-创建</h4><p>规则</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 注意:最后一个<span class="keyword">column</span>没有,</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_name(</span><br><span class="line">   column1 column1_type [comment column1_comment],</span><br><span class="line">   column2 column2_type [comment column2_comment],</span><br><span class="line">   column3 column3_type [comment column3_comment]</span><br><span class="line"> )[comment <span class="string">&#x27;表注释&#x27;</span>];</span><br></pre></td></tr></table></figure>





<p>举例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">create</span> <span class="keyword">table</span> emp_info(</span><br><span class="line">    id <span class="type">int</span> comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">    emp_no <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;员工工号&#x27;</span>,</span><br><span class="line">    emp_name <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;员工姓名&#x27;</span>,</span><br><span class="line">    sex <span class="type">char</span>(<span class="number">1</span>) comment <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    age tinyint unsigned comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    card_num <span class="type">char</span>(<span class="number">18</span>) comment <span class="string">&#x27;身份证号&#x27;</span>,</span><br><span class="line">    emp_date <span class="type">date</span> comment <span class="string">&#x27;入职时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;员工信息表&#x27;</span>;</span><br><span class="line">			</span><br><span class="line">			</span><br></pre></td></tr></table></figure>

<h4 id="表操作-添加字段"><a href="#表操作-添加字段" class="headerlink" title="表操作-添加字段"></a>表操作-添加字段</h4><p>为员工表添加一个花名字段，类型为varchar(20)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp_info <span class="keyword">add</span> nickName <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;花名&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="表操作-修改字段长度"><a href="#表操作-修改字段长度" class="headerlink" title="表操作-修改字段长度"></a>表操作-修改字段长度</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp_info modify nickName <span class="type">varchar</span>(<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<h4 id="表操作-修改字段名和字段类型"><a href="#表操作-修改字段名和字段类型" class="headerlink" title="表操作-修改字段名和字段类型"></a>表操作-修改字段名和字段类型</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp_info change nickName userName <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;用户名&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="表操作-删除字段"><a href="#表操作-删除字段" class="headerlink" title="表操作-删除字段"></a>表操作-删除字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp_info <span class="keyword">drop</span> userName; </span><br></pre></td></tr></table></figure>

<h4 id="表操作-修改表名"><a href="#表操作-修改表名" class="headerlink" title="表操作-修改表名"></a>表操作-修改表名</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp_info rename <span class="keyword">to</span> tb_emp_info;</span><br></pre></td></tr></table></figure>

<h4 id="表操作-清空表数据"><a href="#表操作-清空表数据" class="headerlink" title="表操作-清空表数据"></a>表操作-清空表数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 相当于删除再重新创建表</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> emp_info;</span><br></pre></td></tr></table></figure>

<h4 id="表操作-删除表"><a href="#表操作-删除表" class="headerlink" title="表操作-删除表"></a>表操作-删除表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> emp_info;</span><br></pre></td></tr></table></figure>

<h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h3><p>Data Manipulation Language</p>
<p>导入sql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; source /Users/chaoqiang/Downloads/baidu-netdisk/dept_emp.sql </span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">Query OK, 6 rows affected (0.00 sec)</span><br><span class="line">Records: 6  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>



<h4 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE tb_name <span class="keyword">set</span> col1<span class="operator">=</span>val1,col2<span class="operator">=</span>val2 [<span class="keyword">where</span> <span class="keyword">condition</span>];</span><br></pre></td></tr></table></figure>

<h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> tb_name [<span class="keyword">where</span> comdition];</span><br></pre></td></tr></table></figure>

<h3 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h3><p>Data Query Language</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询语句基本顺序</span><br><span class="line"><span class="keyword">select</span> col1,<span class="built_in">max</span>(col1) <span class="keyword">from</span> tb_name <span class="keyword">where</span> [conditions] [<span class="keyword">group</span> <span class="keyword">by</span> columns] [<span class="keyword">having</span> subcolumns] [<span class="keyword">order</span> <span class="keyword">by</span> columns] limit startoffset pagesize</span><br></pre></td></tr></table></figure>



<ul>
<li>基本查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询多个字段,最好少用<span class="operator">*</span>,影响效率且不直观</span><br><span class="line"><span class="keyword">select</span> columns... <span class="keyword">from</span> tb_name</span><br><span class="line"></span><br><span class="line"># 去除重复记录</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> columns... <span class="keyword">from</span> tb_name</span><br></pre></td></tr></table></figure>



<ul>
<li>条件查询(WHERE)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 这里只写不常用的</span><br><span class="line">#查询某字段数据符合正则表达式(注意\\d不好使，用[<span class="number">0</span><span class="number">-9</span>])</span><br><span class="line"><span class="keyword">select</span> columns <span class="keyword">from</span> tb_name <span class="keyword">where</span> col1 regex <span class="string">&#x27;refex_expression&#x27;</span></span><br><span class="line"># 不等于<span class="operator">&lt;&gt;</span></span><br><span class="line"># <span class="keyword">between</span> ... <span class="keyword">and</span> ...</span><br><span class="line"># <span class="keyword">like</span> 占位符(_匹配单个字符)</span><br><span class="line"># <span class="keyword">and</span> 或<span class="operator">&amp;&amp;</span></span><br><span class="line"># <span class="keyword">or</span> 或<span class="operator">||</span></span><br><span class="line"># <span class="keyword">not</span> 或<span class="operator">!</span></span><br></pre></td></tr></table></figure>



<ul>
<li>聚合函数(count,max,min,avg,sum)</li>
<li>分组查询(group by)</li>
</ul>
<blockquote>
<p>where 与having区别</p>
<blockquote>
<p>执行时机不同:where是分组之前进行过滤，不满足where条件不会参与分组;而having是分组后对结果进行过滤</p>
</blockquote>
<blockquote>
<p>判断条件不同:where不能对聚合函数进行判断，having可以</p>
</blockquote>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 执行顺序:<span class="keyword">where</span> <span class="operator">&gt;</span>聚合函数<span class="operator">&gt;</span><span class="keyword">having</span></span><br><span class="line"># 分组之后，查询的字段一般为聚合函数和分组字段，查询其他条件无任何意义</span><br></pre></td></tr></table></figure>



<ul>
<li>排序查询(ORDER BY)</li>
<li>分页查询(LIMIT)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 分页查询是数据库的方言，不同数据库有不同实现，Mysql中是limit，如果从头开始查,起始索引可以不写，直接limit rowcount</span><br><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名limit 起始索引,查询记录数</span><br></pre></td></tr></table></figure>

<p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查询年龄为<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>岁的员工信息。</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp_info ei <span class="keyword">where</span> ei.age <span class="keyword">in</span> (<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>)</span><br><span class="line"># 查询性别为男，并且年龄在<span class="number">20</span><span class="number">-40</span>岁(含)以内的姓名为三个字的员工。</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp_info ei <span class="keyword">where</span> ei.age <span class="keyword">between</span> <span class="number">20</span> <span class="keyword">and</span> <span class="number">40</span> <span class="keyword">and</span> sex <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">and</span> length(name) <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"># 统计员工表中,年龄小于<span class="number">60</span>岁的,男性员工和女性员工的人数。</span><br><span class="line"><span class="keyword">select</span> sex,<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> emp_info <span class="keyword">where</span> age <span class="operator">&lt;</span> <span class="number">60</span> <span class="keyword">group</span> <span class="keyword">by</span> sex;</span><br><span class="line"># 查询所有年龄小于等于<span class="number">35</span>岁员工的姓名和年龄，并对查询结果按年龄升序排序，如果年龄相同按入职时间降序排序。</span><br><span class="line"><span class="keyword">select</span> name,age <span class="keyword">from</span> emp_info ei <span class="keyword">where</span> ei.age <span class="operator">&lt;=</span><span class="number">35</span> <span class="keyword">order</span> <span class="keyword">by</span> age ,emp_date <span class="keyword">desc</span>;</span><br><span class="line"># 查询性别为男，且年龄在<span class="number">20</span><span class="number">-40</span>岁(含)以内的前<span class="number">5</span>个员工信息，对查询的结果按年龄升序排序，年龄相同按入职时间升序排序。</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp_info ei <span class="keyword">where</span> sex <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">and</span> age <span class="keyword">between</span> <span class="number">20</span> <span class="keyword">and</span> <span class="number">40</span> <span class="keyword">order</span> <span class="keyword">by</span> age,emp_date <span class="keyword">desc</span> limit <span class="number">5</span> </span><br></pre></td></tr></table></figure>

<h4 id="DQL执行语句顺序"><a href="#DQL执行语句顺序" class="headerlink" title="DQL执行语句顺序"></a>DQL执行语句顺序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 语法顺序</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	字段列表</span><br><span class="line"><span class="keyword">from</span> 	</span><br><span class="line">	表名列表</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">	条件列表	</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">	分组列表</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line">	分组后条件列表</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">	排序字段列表</span><br><span class="line">limit </span><br><span class="line">	分页参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 执行顺序</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	表名列表</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">	条件列表</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">	分组列表</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	字段列表</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line">	分组后题哦啊蹇列表</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">	排序字段列表</span><br><span class="line">limit	</span><br><span class="line">	分页参数</span><br></pre></td></tr></table></figure>

<h3 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h3><p>Data Control Language,用于管理数据库用户，控制数据库的访问权限</p>
<h4 id="DCL-用户管理"><a href="#DCL-用户管理" class="headerlink" title="DCL-用户管理"></a>DCL-用户管理</h4><p>查询用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>创建，修改，删除用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#mysql使用ip<span class="operator">+</span>用户名来定位唯一用户</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;密码&#x27;</span>；</span><br><span class="line"># 创建用户itcast,只能再当前主机localhost访问，密码<span class="number">123456</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;itcast&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"># 创建用户heima,可以在任意ip访问该数据库，密码<span class="number">123456</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;heima&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"># 修改用户heima的访问密码为<span class="number">654321</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;heima&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;654321&#x27;</span>;</span><br><span class="line"># 删除用户itcast用户</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;itcast&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="DCL-权限控制"><a href="#DCL-权限控制" class="headerlink" title="DCL-权限控制"></a>DCL-权限控制</h4><table>
<thead>
<tr>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ALL,ALL PRIVILEGES</td>
<td>所有权限</td>
</tr>
<tr>
<td>SELECT</td>
<td>查询数据</td>
</tr>
<tr>
<td>INSERT</td>
<td>插入数据</td>
</tr>
<tr>
<td>UPDATE</td>
<td>修改数据</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除数据</td>
</tr>
<tr>
<td>ALTER</td>
<td>修改表</td>
</tr>
<tr>
<td>DROP</td>
<td>删除数据库/表/视图</td>
</tr>
<tr>
<td>CREATE</td>
<td>创建数据库/表</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查询权限</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span></span><br><span class="line"></span><br><span class="line"># 授予权限</span><br><span class="line"><span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 数据库名.表名 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span></span><br><span class="line"></span><br><span class="line"># 撤销权限</span><br><span class="line"><span class="keyword">REVOKE</span> 权限列表 <span class="keyword">ON</span>  数据库名.表名 <span class="keyword">FROM</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>一段可以直接被另一段程序调用的程序或代码</p>
<h4 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CONCAT(s1,s2,s3…sn)</td>
<td>字符串拼接</td>
</tr>
<tr>
<td>LOWER(str)</td>
<td></td>
</tr>
<tr>
<td>UPPER(str)</td>
<td></td>
</tr>
<tr>
<td>LPAD(str,n,pad)</td>
<td>左填充，用字符串pad对str的左边进行填充</td>
</tr>
<tr>
<td>RPAD(str,n,pad)</td>
<td>右填充，用字符串pad对str的右边进行填充</td>
</tr>
<tr>
<td>TRIM(str)</td>
<td>去掉字符串头部和尾部的空格</td>
</tr>
<tr>
<td>SUBSTRING(str,start,len)</td>
<td>返回从字符串str从start位置起的len个长度的字符串</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> lpad(<span class="string">&#x27;s&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> rpad(<span class="string">&#x27;s&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;hello mysql&#x27;</span>,<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;hello mysql&#x27;</span>,<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">substring</span>(<span class="string">&#x27;hello mysql&#x27;</span>,<span class="number">1</span>,<span class="number">3</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------+</span></span><br><span class="line"><span class="operator">|</span> hel                          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"># 由于业务变更，需要将员工工号统一为五位数，不足<span class="number">5</span>位数的全部在前面补<span class="number">0</span>，比如<span class="number">1</span>号员工工号应为<span class="number">00001</span></span><br><span class="line">update emp_info ei <span class="keyword">set</span> ei.workno <span class="operator">=</span> lpad(ei.workno,<span class="number">5</span>,<span class="string">&#x27;0&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CEIL(x)</td>
<td>向上取整</td>
</tr>
<tr>
<td>FLOOR(x)</td>
<td>向下取整</td>
</tr>
<tr>
<td>MOD(x,y)</td>
<td>返回x/y的模</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回0-1内的随机数</td>
</tr>
<tr>
<td>ROUND(x,y)</td>
<td>求参数x的四舍五入的值，保留y位小数</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">ceil</span>(<span class="number">1.01</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">ceil</span>(<span class="number">1.01</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">floor</span>(<span class="number">1.01</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">floor</span>(<span class="number">1.01</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">mod</span>(<span class="number">5</span>,<span class="number">3</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">mod</span>(<span class="number">5</span>,<span class="number">3</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> rand();</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> rand()             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0.5655649225838155</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> round(<span class="number">2.1415926</span>,<span class="number">3</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> round(<span class="number">2.1415926</span>,<span class="number">3</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span>              <span class="number">2.142</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">1000000</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">1000000</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------+</span></span><br><span class="line"><span class="operator">|</span>                <span class="number">399993</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"># 随机生成六位随机验证码</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> lpad(<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">1000000</span>),<span class="number">6</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> lpad(<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">1000000</span>),<span class="number">6</span>,<span class="string">&#x27;0&#x27;</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">760415</span>                            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> lpad(round(<span class="number">0.99999999999</span><span class="operator">*</span><span class="number">1000000</span>,<span class="number">0</span>),<span class="number">6</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> lpad(round(<span class="number">0.99999999999</span><span class="operator">*</span><span class="number">1000000</span>,<span class="number">0</span>),<span class="number">6</span>,<span class="string">&#x27;0&#x27;</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">100000</span>                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>curdate()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>curtime()</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>now()</td>
<td>返回当前日期+时间</td>
</tr>
<tr>
<td>year(date)</td>
<td>获取指定date的年份</td>
</tr>
<tr>
<td>month(date)</td>
<td>获取指定date的月份</td>
</tr>
<tr>
<td>day(date)</td>
<td>获取指定date的日期</td>
</tr>
<tr>
<td>DATE_ADD(date,INTERVAL expr type)</td>
<td>返回一个日期/时间值加上一个时间间隔expr后的时间值</td>
</tr>
<tr>
<td>DATEDIFF(date1,date2)</td>
<td>返回起始时间date1和结束时间date2之间的天数</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select curdate();</span><br><span class="line">+------------+</span><br><span class="line">| curdate()  |</span><br><span class="line">+------------+</span><br><span class="line">| 2022-02-12 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select curtime();</span><br><span class="line">+-----------+</span><br><span class="line">| curtime() |</span><br><span class="line">+-----------+</span><br><span class="line">| 13:39:05  |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select now();</span><br><span class="line">+---------------------+</span><br><span class="line">| now()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2022-02-12 13:39:11 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select year(now());</span><br><span class="line">+-------------+</span><br><span class="line">| year(now()) |</span><br><span class="line">+-------------+</span><br><span class="line">|        2022 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select month(now());</span><br><span class="line">+--------------+</span><br><span class="line">| month(now()) |</span><br><span class="line">+--------------+</span><br><span class="line">|            2 |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select day(now());</span><br><span class="line">+------------+</span><br><span class="line">| day(now()) |</span><br><span class="line">+------------+</span><br><span class="line">|         12 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select date_add(now(),interval 1 day);</span><br><span class="line">+--------------------------------+</span><br><span class="line">| date_add(now(),interval 1 day) |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| 2022-02-13 13:40:34            |</span><br><span class="line">+--------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select date_add(date(now()),interval 1 day);</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| date_add(date(now()),interval 1 day) |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| 2022-02-13                           |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select date_add(date(now()),interval 1 month);</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| date_add(date(now()),interval 1 month) |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| 2022-03-12                             |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select date_add(date(now()),interval 1 year);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| date_add(date(now()),interval 1 year) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| 2023-02-12                            |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 查询明年今天与今年今天的日期数</span><br><span class="line">mysql&gt; select datediff(date_add(date(now()),interval 1 year),now());</span><br><span class="line">+-------------------------------------------------------+</span><br><span class="line">| datediff(date_add(date(now()),interval 1 year),now()) |</span><br><span class="line">+-------------------------------------------------------+</span><br><span class="line">|                                                   365 |</span><br><span class="line">+-------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 查询去年今天与今天的日期数</span><br><span class="line">mysql&gt; select datediff(date_add(date(now()),interval -1 year),now());</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">| datediff(date_add(date(now()),interval -1 year),now()) |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">|                                                   -365 |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 查询所有员工的入职天数，并根据入职天数倒序排序</span><br><span class="line">mysql&gt; select emp_no,datediff(curdate(),emp_date) work_day from emp_info ei order by work_day desc;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>IF(value,t,f)</td>
<td>如果value为true,则返回t,否则返回f</td>
</tr>
<tr>
<td>IFNULL(value1,value2)</td>
<td>如果value1不为空，返回value1，否则返回value2</td>
</tr>
<tr>
<td>CASE WHEN [val1] THEN [res1] … ELSE [default] END</td>
<td>如果val1为true，返回res1…否则返回default默认值</td>
</tr>
<tr>
<td>CASE [expr] WHEN [val1] THEN [res1] … [default] END</td>
<td>如果expr的值等于val1，返回res1 ,…否则返回default默认值</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 统计班里学员成绩，展示规则如下</span><br><span class="line"># &gt;=85展示优秀	&gt;=60及格	否则，不及格</span><br><span class="line">mysql&gt; select s.name,</span><br><span class="line">    -&gt; case when s.math &gt;=85 then &#x27;优秀&#x27; when s.math &gt;=60 then &#x27;及格&#x27; else &#x27;不及格&#x27; end &#x27;数学&#x27;,</span><br><span class="line">    -&gt; case when s.english &gt;=85 then &#x27;优秀&#x27; when s.math &gt;=60 then &#x27;及格&#x27; else &#x27;不及格&#x27; end &#x27;英语&#x27;,</span><br><span class="line">    -&gt; case when s.chinese &gt;=85 then &#x27;优秀&#x27; when s.math &gt;=60 then &#x27;及格&#x27; else &#x27;不及格&#x27; end &#x27;语文&#x27;</span><br><span class="line">    -&gt; from score s;</span><br><span class="line">+------+-----------+-----------+-----------+</span><br><span class="line">| name | 数学      | 英语      | 语文      |</span><br><span class="line">+------+-----------+-----------+-----------+</span><br><span class="line">| Tom  | 及格      | 优秀      | 优秀      |</span><br><span class="line">| Rose | 不及格    | 不及格    | 优秀      |</span><br><span class="line">| Jack | 不及格    | 优秀      | 不及格    |</span><br><span class="line">+------+-----------+-----------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><blockquote>
<p>概念:约束是作用于表中字段上的规则，用于限制存储在表中的数据</p>
<p>目的:保证数据库中数据的正确，有效性和完整性</p>
</blockquote>
<p>分类</p>
<table>
<thead>
<tr>
<th>约束</th>
<th>描述</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>非空约束</td>
<td>限制该字段数据不能为null</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>唯一约束</td>
<td>保证该字段的所有数据都是唯一，不重复的</td>
<td>UNIQUE</td>
</tr>
<tr>
<td>主键约束</td>
<td>主键是一行数据的唯一表示，要求非空且唯一</td>
<td>PRIMARY KEY</td>
</tr>
<tr>
<td>默认约束</td>
<td>保存数据时，如果未指定该字段的值，则采用默认值</td>
<td>DEFAULT</td>
</tr>
<tr>
<td>检查约束(8.0.16版本之后)</td>
<td>保证字段值满足某一个条件</td>
<td>CHECK</td>
</tr>
<tr>
<td>外键约束</td>
<td>用来让两张表的数据之间建立连接，保证数据的一致性和完整性</td>
<td>FOREIGN KEY</td>
</tr>
</tbody></table>
<p>练习:创建用户表tb_user</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>字段含义</th>
<th>字段类型</th>
<th>约束条件</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>ID唯一标识</td>
<td>int</td>
<td>主键，并且自动增长</td>
</tr>
<tr>
<td>name</td>
<td>姓名</td>
<td>varchar(10)</td>
<td>不为空，唯一</td>
</tr>
<tr>
<td>age</td>
<td>年龄</td>
<td>tinyint</td>
<td>大于0,并且小于等于120</td>
</tr>
<tr>
<td>status</td>
<td>状态</td>
<td>char(1)</td>
<td>如果没有指定该值，默认为1</td>
</tr>
<tr>
<td>gender</td>
<td>性别</td>
<td>char(1)</td>
<td>无</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user(</span><br><span class="line">	id <span class="type">int</span> auto_increment <span class="keyword">primary</span> key comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  age tinyint unsigned comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">  status <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;1&#x27;</span> comment <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  gender <span class="type">char</span>(<span class="number">1</span>) comment <span class="string">&#x27;性别&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h4><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>概念:用来让两张表的数据之间建立连接，从而保证数据的一致性和完整性</p>
</blockquote>
<p>语法:</p>
<p>新建外键约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">  ...</span><br><span class="line">  [CONSTRANT] [外键名称] <span class="keyword">FOREIGN</span> KEY (外键字段名) <span class="keyword">REFERENCES</span> 主表(主表列名)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 新建表时直接指定主键</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> emp01( </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY  COMMENT <span class="string">&#x27;ID&#x27;</span>,   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   `name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   `dept_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">null</span> COMMENT <span class="string">&#x27;部门ID&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">CONSTRAINT</span> fk_emp_dept_id <span class="keyword">FOREIGN</span> KEY(dept_id) <span class="keyword">references</span> dept(id) );</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 表已存在时添加外键</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_emp_dept_id2 <span class="keyword">FOREIGN</span> KEY(dept_id) <span class="keyword">references</span> dept(id);</span><br><span class="line">Query OK, <span class="number">6</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line">Records: <span class="number">6</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line">#	 注意，不能存在两个相同名称的外键</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>删除外键约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键名称;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">drop</span> <span class="keyword">foreign</span> key fk_emp_dept_id2;</span><br></pre></td></tr></table></figure>

<h4 id="行为"><a href="#行为" class="headerlink" title="行为"></a>行为</h4><ul>
<li>删除/更新行为</li>
</ul>
<table>
<thead>
<tr>
<th>行为</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>NO ACTION</td>
<td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新(与RESTRICT一致)</td>
</tr>
<tr>
<td>RESTRICT</td>
<td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新(与NO ACTION一致)</td>
</tr>
<tr>
<td>CASCADE</td>
<td>当在父表中<strong>删除/更新</strong>对应记录时，首先检查该记录是否有对应主键，如果有，则也删除/更新外键在子表中的记录(就是说主表中的键修改或删除，关联表的关联记录也会同步修改或删除)</td>
</tr>
<tr>
<td>SET NULL</td>
<td>当在父表中<strong>删除</strong>对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null(这就要求该外键允许取null)</td>
</tr>
<tr>
<td>SET DEFAULT</td>
<td>父表有<strong>变更</strong>时，子表将外键列设置成一个默认的值(Innodb不支持)</td>
</tr>
</tbody></table>
<p>设置外键约束行为</p>
<p>其实就是在添加字段时加上ON UPDATE 更新策略 ,ON DELETE 删除策略</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 外键名称 <span class="keyword">FOREIGN</span> KEY (外键字段) <span class="keyword">REFERENCES</span> 主表名(主表字段名) <span class="keyword">ON</span> UPDATE 更新行为 <span class="keyword">ON</span> <span class="keyword">DELETE</span> 删除行为</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">add</span> <span class="keyword">constraint</span> fk_emp_dept <span class="keyword">foreign</span> key(dept_id) <span class="keyword">references</span> dept(id) <span class="keyword">on</span> update CASCADE <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>;</span><br><span class="line">Query OK, <span class="number">6</span> <span class="keyword">rows</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line">Records: <span class="number">6</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br></pre></td></tr></table></figure>



<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="多表关系"><a href="#多表关系" class="headerlink" title="多表关系"></a>多表关系</h3><ul>
<li>一对多-    一个省下面对应多个市<ul>
<li>在多的一方建立外键，关联另一方的主键</li>
</ul>
</li>
<li>多对多-     角色和权限<ul>
<li>建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</li>
</ul>
</li>
<li>一对一-     用户与用户详情<ul>
<li>在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的UNIQUE</li>
</ul>
</li>
</ul>
<h3 id="多表查询概述"><a href="#多表查询概述" class="headerlink" title="多表查询概述"></a>多表查询概述</h3><blockquote>
<p>笛卡尔积:笛卡尔积是指在数学中，集合A和集合B的所有组合情况(在多表查询时，需要消除无效的笛卡尔积)</p>
</blockquote>
<h4 id="多表查询分类"><a href="#多表查询分类" class="headerlink" title="多表查询分类"></a>多表查询分类</h4><table>
<thead>
<tr>
<th>连接类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>内连接</td>
<td>相当于查询A,B交集部分数据</td>
</tr>
<tr>
<td>左外连接</td>
<td>相当于查询A表所有数据</td>
</tr>
<tr>
<td>右外连接</td>
<td>相当于查询B表所有数据</td>
</tr>
<tr>
<td>自连接</td>
<td>当前表与自身的连接查询，自连接必须使用表别名</td>
</tr>
</tbody></table>
<p>内连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 隐式内连接</span><br><span class="line">select 字段列表 from 表1,表2 where 条件...;</span><br><span class="line"># 显式内连接</span><br><span class="line">select 字段列表 from 表1 inner join 表2 on 表1.字段a = 表2.字段b</span><br></pre></td></tr></table></figure>



<blockquote><p>Personally I prefer the join syntax as its makes it clearer that the tables are joined and how they are joined. Try compare larger SQL queries where you selecting from 8 different tables and you have lots of filtering in the where. By using join syntax you separate out the parts where the tables are joined, to the part where you are filtering the rows.</p>
<p>更建议使用显式外连接，尽管sql优化器会将其优化成相同的执行计划</p>
<footer><strong>stackoverflow</strong><cite><a class="link" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/44917/explicit-vs-implicit-sql-joins13.2.10.2">Explicit vs implicit SQL joins<i class="fas fa-external-link-alt"></i></a></cite></footer></blockquote>



<p>自连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表A 别名A <span class="keyword">inner</span> <span class="keyword">join</span> 表A 别名B <span class="keyword">on</span> 条件</span><br><span class="line"># 自连接查询，可以是内连接查询，也可以是外连接查询</span><br></pre></td></tr></table></figure>

<p>联合查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 from 表A ...</span><br><span class="line">union [all]</span><br><span class="line">select 字段列表 from 表B ...</span><br><span class="line"># 对于联合查询的多张表的列数必须保持一致，字段类型也需要保持一致</span><br><span class="line"># union all会将全部的数据直接合并到一起,union 会对合并之后的数据去重</span><br></pre></td></tr></table></figure>

<p>子查询</p>
<blockquote>
<p>概念:SQL中嵌套SELECT语句，称为嵌套查询，又称子查询</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> column1 <span class="operator">=</span> (<span class="keyword">select</span> column1 <span class="keyword">from</span> t2);</span><br><span class="line"># 子查询外部的语句可以是<span class="keyword">INSERT</span>,UPDATE<span class="operator">/</span><span class="keyword">DELETE</span><span class="operator">/</span><span class="keyword">SELECT</span>的任何一个</span><br></pre></td></tr></table></figure>

<p>根据子查询结果不同，分为:</p>
<table>
<thead>
<tr>
<th>根据子查询结果分类</th>
<th>现象</th>
<th>操作符</th>
</tr>
</thead>
<tbody><tr>
<td>标量子查询</td>
<td>子查询结果为单个值</td>
<td>=,&lt;&gt;,&gt;,&lt;</td>
</tr>
<tr>
<td>列子查询</td>
<td>子查询结果为1列</td>
<td>in,not in<br>any有任意一个满足即可<br>SOME与ANY等同 <br>ALL子查询返回列表的所有值都必须满足</td>
</tr>
<tr>
<td>行子查询</td>
<td>子查询结果为1行</td>
<td>=，&lt;&gt;.IN,NOT IN</td>
</tr>
<tr>
<td>表子查询</td>
<td>返回结果为多行多列</td>
<td>IN</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>演示列子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查询比财务部所有人工资都高的员工信息,使用<span class="keyword">all</span>，就是比范围内的数据都要...</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="keyword">all</span> ( </span><br><span class="line">	<span class="keyword">select</span> salary <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;财务部&#x27;</span></span><br><span class="line">);</span><br><span class="line"># 查询比研发部其中任意一人工资高的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="keyword">any</span> ( </span><br><span class="line">	<span class="keyword">select</span> salary <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;研发部&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>演示行子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- 查询张无忌的薪资及直属领导</span></span><br><span class="line"><span class="keyword">select</span> salary,managerid <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;张无忌&#x27;</span>;</span><br><span class="line">salary managerid</span><br><span class="line"><span class="number">12500</span>，   <span class="number">1</span></span><br><span class="line"><span class="comment">-- # 查询与张无忌的薪资及直属领导相同的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">=</span> <span class="number">12500</span> <span class="keyword">and</span> managerid <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> (salary,managerid) <span class="operator">=</span> (<span class="number">12500</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">-- 进一步演化为</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> (salary,managerid) <span class="operator">=</span> (<span class="keyword">select</span> salary,managerid <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;张无忌&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p> 演示表子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询与张三，李四的职位和薪资相同的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> (job,salary) <span class="keyword">in</span> (<span class="keyword">select</span> job,salary <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;李四&#x27;</span>)</span><br><span class="line"><span class="comment">-- 查询入职日期是2006-01-01之后的员工信息及部门信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">left</span> <span class="keyword">join</span> dep <span class="keyword">on</span> emp.dept_id <span class="operator">=</span> dep.id <span class="keyword">where</span> emp.entry_date <span class="operator">&gt;</span> <span class="string">&#x27;2006-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="连接查询练习"><a href="#连接查询练习" class="headerlink" title="连接查询练习"></a>连接查询练习</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.id,e.age ,e.job ,d.name <span class="keyword">FROM</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.dept_id  <span class="operator">=</span> d.id </span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> e.name ,e.age ,e.job ,d.name <span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id <span class="keyword">WHERE</span> e.age  <span class="operator">&lt;</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> d.id,d.name <span class="keyword">from</span> dept d <span class="keyword">where</span> d.id <span class="operator">=</span> <span class="keyword">ANY</span> (<span class="keyword">SELECT</span> e.dept_id <span class="keyword">from</span> emp e);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span> ,d.name <span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id <span class="keyword">WHERE</span> e.age  <span class="operator">&gt;</span> <span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.name ,s.grade <span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> salgrade s <span class="keyword">on</span> e.salary <span class="keyword">BETWEEN</span> s.losal <span class="keyword">and</span> s.hisal </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.name ,s.grade <span class="keyword">from</span> emp e </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> salgrade s <span class="keyword">on</span> e.salary <span class="keyword">BETWEEN</span> s.losal <span class="keyword">and</span> s.hisal </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id <span class="keyword">where</span> d.name  <span class="operator">=</span> <span class="string">&#x27;研发部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(e.salary)  <span class="keyword">from</span> emp e </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id <span class="keyword">where</span> d.name  <span class="operator">=</span> <span class="string">&#x27;研发部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> salary <span class="keyword">from</span> emp e2 <span class="keyword">WHERE</span> e2.name <span class="operator">=</span> <span class="string">&#x27;灭绝&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(e2.salary) <span class="keyword">from</span> emp e2 )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.dept_id ,<span class="built_in">AVG</span>(e.salary) <span class="keyword">from</span> emp e <span class="keyword">group</span> <span class="keyword">by</span> e.dept_id </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">inner</span> <span class="keyword">join</span> (<span class="keyword">SELECT</span> e.dept_id ,<span class="built_in">AVG</span>(e.salary) dep_avg <span class="keyword">from</span> emp e <span class="keyword">group</span> <span class="keyword">by</span> e.dept_id </span><br><span class="line">) tmp <span class="keyword">on</span> e.dept_id <span class="operator">=</span> tmp.dept_id <span class="keyword">where</span> e.salary <span class="operator">&lt;</span> tmp.dep_avg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> d.<span class="operator">*</span>,IFNULL(tmp.person_count,<span class="number">0</span>)  <span class="keyword">from</span> dept d <span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) person_count,e2.dept_id <span class="keyword">from</span> emp e2 <span class="keyword">group</span> <span class="keyword">by</span> e2.dept_id ) tmp</span><br><span class="line"><span class="keyword">on</span> d.id  <span class="operator">=</span> tmp.dept_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> s.name ,s.`<span class="keyword">no</span>` ,c.name <span class="keyword">from</span> student s </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> student_course sc <span class="keyword">on</span> s.id  <span class="operator">=</span> sc.courseid </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> course c <span class="keyword">on</span> sc.courseid  <span class="operator">=</span> c.id </span><br></pre></td></tr></table></figure>

<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote>
<p>事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败</p>
<p>简单说就是执行一组操作，要么同时成功，要么同时失败</p>
</blockquote>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 查看 <span class="operator">/</span>设置事务提交方式</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@autocommit</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> @<span class="variable">@autocommit</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"># 开启事务</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"># 提交事务</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"># 回滚事务</span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure>

<h4 id="事务四大特性"><a href="#事务四大特性" class="headerlink" title="事务四大特性"></a>事务四大特性</h4><ul>
<li>原子性:事务内的所有操作为一个原子，要么全成功，要么全失败</li>
<li>一致性:事务执行后，实际结果与预期结果一致</li>
<li>隔离型:保证事务在不受外部并发操作影响的独立环境下运行</li>
<li>持久性:事务一旦提交或回滚，它对数据库中的数据的改变是永久的</li>
</ul>
<h4 id="并发事务问题"><a href="#并发事务问题" class="headerlink" title="并发事务问题"></a>并发事务问题</h4><p>拿A和B去饭店吃饭，付钱环节举例:</p>
<p>A或B任意一人付钱就会向表中新建一条记录，且status默认为1(服务员拒收后，状态改为0)</p>
<p>假设B付的钱中有假钱:</p>
<table>
<thead>
<tr>
<th>问题</th>
<th>描述</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>一个事务读到另外一个事务还没有提交的数据</td>
<td>B付款，服务员还没确认，A这时查到数据库中有这条记录且status为1，就认为已经付款成功了</td>
</tr>
<tr>
<td>不可重复读</td>
<td>一个事务先后读取同一条记录，但两次读取的数据不同，称为不可重复读</td>
<td>B付款，A第一次付款发现status为1，等10s后不放心，再看一眼记录发现status竟然为0了</td>
</tr>
<tr>
<td>幻读</td>
<td>一个事务按照条件查询数据时，没有对应的数据行，但在插入数据时，又发现这行数据已存在</td>
<td>A打算付款，看表中没有数据，掏了钱包说刷我卡，服务员说已经有人买单了，A再看发现表中竟然已经多了那条记录</td>
</tr>
</tbody></table>
<h4 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h4><table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>Read uncommitted(警察看到小偷将手摸到了钱包，直接抓人)</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>Read committed(警察看到了小偷将钱包拿出来，但小偷看见警察后直接把钱包放了回去)</td>
<td>✕</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>Repeatable Read(警察直接将小偷制服，但小偷同伙儿又将钱包塞了回去)</td>
<td>✕</td>
<td>✕</td>
<td>✓</td>
</tr>
<tr>
<td>Serializable(保护现场+拉警戒线)</td>
<td>✕</td>
<td>✕</td>
<td>✕</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查看事务隔离级别</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@TRANSACTION</span>_ISOLATION</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@TRANSACTION</span>_ISOLATION;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@TRANSACTION</span>_ISOLATION <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">-- 设置事务隔离级别</span></span><br><span class="line"><span class="keyword">SET</span> [SESSION <span class="operator">|</span> <span class="keyword">GLOBAL</span>] TRANSACTION ISOLATION LEVEL &#123;READ UNCOMMITTED <span class="operator">|</span> READ COMMITTED <span class="operator">|</span> READ COMMITTED <span class="operator">|</span>REPEATABLE READ <span class="operator">|</span> SERIALIZABAL&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote><ul>
<li>With the <code>GLOBAL</code> keyword:<ul>
<li>The statement applies globally for all subsequent sessions.</li>
<li>Existing sessions are unaffected.</li>
<li>适用于开启的新session，已有session不受影响</li>
</ul>
</li>
<li>With the <code>SESSION</code> keyword:<ul>
<li>The statement applies to all subsequent transactions performed within the current session.</li>
<li>The statement is permitted within transactions, but does not affect the current ongoing transaction.</li>
<li>If executed between transactions, the statement overrides any preceding statement that sets the next-transaction value of the named characteristics.</li>
<li>适用于当前session的后续事务，允许在事务中执行这条语句，但不会影响当前事务，第三句和第一句意思一样</li>
</ul>
</li>
<li>Without any <code>SESSION</code> or <code>GLOBAL</code> keyword:<ul>
<li>The statement applies only to the next single transaction performed within the session.</li>
<li>Subsequent transactions revert to using the session value of the named characteristics.</li>
<li>The statement is not permitted within transactions:</li>
<li>如果不设置默认值，只会在当前session的下一个事务中生效，然后就恢复，不允许在事务中执行这条语句</li>
</ul>
</li>
</ul>
<footer><strong>mysql</strong><cite><a class="link" target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/set-transaction.html">Transaction Characteristic Scope<i class="fas fa-external-link-alt"></i></a></cite></footer></blockquote>


        </div>

        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/02/07/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">mysql数据库笔记</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/02/07/jdk8%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E4%BB%A3%E6%9B%BF%E5%8F%8D%E5%B0%84%E6%93%8D%E4%BD%9C/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">jdk8模板方法代替反射操作</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div id="gitalk-container"></div>
    <script 
            src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
    <script >

        function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
                __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
                Gitalk && new Gitalk({
                    clientID: '863fbb8458b81279c355',
                    clientSecret: 'de73deafd00d910696772359a03ee417eca8e244',
                    repo: 'chaoqiang6.github.io',
                    owner: 'chaoqiang6',
                    admin: ['chaoqiang6'],
                    id: __gitalk__pathname,
                    language: 'zh-CN'
                }).render('gitalk-container');

            } catch (e) {
                window.Gitalk = null;
            }
        }

        if ('false') {
            const loadGitalkTimeout = setTimeout(() => {
                loadGitalk();
                clearTimeout(loadGitalkTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
        }
    </script>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">chaoqiang.qiu</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mysql%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">Mysql数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sql%E8%AF%AD%E5%8F%A5"><span class="nav-text">Sql语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DDL"><span class="nav-text">DDL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">数据库操作-查询所有数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">数据库操作-查看当前数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-%E5%88%9B%E5%BB%BA"><span class="nav-text">数据库操作-创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-%E5%88%A0%E9%99%A4"><span class="nav-text">数据库操作-删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-%E4%BD%BF%E7%94%A8"><span class="nav-text">数据库操作-使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%80%E6%9C%89%E8%A1%A8"><span class="nav-text">表操作-查询当前数据库所有表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-text">表操作-查询表结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E8%A1%A8%E7%9A%84%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="nav-text">表操作-查询指定表的建表语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E5%88%9B%E5%BB%BA"><span class="nav-text">表操作-创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5"><span class="nav-text">表操作-添加字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E9%95%BF%E5%BA%A6"><span class="nav-text">表操作-修改字段长度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E5%90%8D%E5%92%8C%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="nav-text">表操作-修改字段名和字段类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5"><span class="nav-text">表操作-删除字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%90%8D"><span class="nav-text">表操作-修改表名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E6%B8%85%E7%A9%BA%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="nav-text">表操作-清空表数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C-%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="nav-text">表操作-删除表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DML"><span class="nav-text">DML</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="nav-text">修改数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-text">删除数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DQL"><span class="nav-text">DQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DQL%E6%89%A7%E8%A1%8C%E8%AF%AD%E5%8F%A5%E9%A1%BA%E5%BA%8F"><span class="nav-text">DQL执行语句顺序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DCL"><span class="nav-text">DCL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DCL-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-text">DCL-用户管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DCL-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-text">DCL-权限控制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="nav-text">数值函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-text">日期函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="nav-text">流程函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A6%E6%9D%9F"><span class="nav-text">约束</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="nav-text">外键约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA"><span class="nav-text">行为</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-text">多表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="nav-text">多表关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%A6%82%E8%BF%B0"><span class="nav-text">多表查询概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="nav-text">多表查询分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2%E7%BB%83%E4%B9%A0"><span class="nav-text">连接查询练习</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C"><span class="nav-text">操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="nav-text">事务四大特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="nav-text">并发事务问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-text">事务隔离级别</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
